$(function(){function e(){function e(e,i){if(i==google.maps.places.PlacesServiceStatus.OK){var r=o.getMap(),a=new n(e[0],r);a.setInfoWindow(a.title),t.markers.push(a),t.visibleMarkersCount(t.visibleMarkersCount()+1),t.locationLat("")}}var t=this;ko.bindingHandlers.mapBinder={init:function(e,n,t,i){o.setMap(n,e)}},t.centerMap=ko.observable(o.getMapCenter()),t.mapDimensions=ko.observable(o.getMapDimensions()),t.markers=ko.observableArray([]),t.locationLat=ko.observable(""),t.addMarkerOnMap=function(){var n=o.getSearchService(),i={query:t.locationLat()};n.textSearch(i,e)},t.toggle=ko.observable(!0),t.titleSearch=ko.observable(""),t.filteredMarkers=this.markers.filterByProperty("visible",!0),t.visibleMarkersCount=ko.observable(0),t.showDummyCard=ko.computed(function(){return 0==t.visibleMarkersCount()&&t.toggle}),t.markerToggler=function(e){t.visibleMarkersCount(0);for(var o in t.markers()){var n=t.markers()[o];n.isVisible(null!=n.title().match(e)),n.isVisible()&&t.visibleMarkersCount(t.visibleMarkersCount()+1)}},this.toggle.subscribe(function(e){t.markerToggler(e?"":null)}),this.toggleMarkersForSearch=function(e){var o=new RegExp(e,"i");t.markerToggler(o)},t.titleSearch.subscribe(t.toggleMarkersForSearch)}ko.observableArray.fn.filterByProperty=function(e,o){return ko.pureComputed(function(){for(var n=this(),t=[],i=0;i<n.length;i++){var r=n[i];ko.unwrap(r[e])===o&&t.push(r)}return t},this)};var o={setMap:function(e,o){var n=ko.utils.unwrapObservable(e()),t=new google.maps.LatLng(ko.utils.unwrapObservable(n.lat),ko.utils.unwrapObservable(n.lng)),i={center:t,zoom:13};this.map=new google.maps.Map(o,i),window.mapBounds=new google.maps.LatLngBounds,this.searchService=new google.maps.places.PlacesService(this.map),this.infoWindow=new google.maps.InfoWindow({content:""})},getMap:function(){return this.map},getSearchService:function(){return this.searchService},getMapCenter:function(){return{lat:ko.observable(40.7127),lng:ko.observable(-74.0059)}},getMapDimensions:function(){var e=$("main").height()+40;return{width:"100%",height:""+e+"px"}},getInfoWindow:function(){return this.infoWindow}},n=function(e,n){var t=e.geometry.location.lat(),i=e.geometry.location.lng(),r=e.formatted_address,a=this;a.icon=e.icon,a.title=ko.observable(r),a.name=e.name,a.content=ko.observable(""),a.infolink=ko.observable("https://en.wikipedia.org/wiki/"+a.name),$.ajax({url:"https://en.wikipedia.org/w/api.php?action=query&prop=extracts&format=json&exintro=&titles="+a.name,type:"GET",crossDomain:!0,dataType:"jsonp",success:function(e){try{var o=Object.keys(e.query.pages)[0];a.content($($(e.query.pages[o].extract)[0].innerHTML).text())}catch(n){console.log("Failed to parse content about location : "+a.name),a.content("Could not get additional information.")}},error:function(){console.log("Failed to parse content about location : "+a.name),a.content("Could not get additional information.")}}),a.googleMarker=new google.maps.Marker({position:new google.maps.LatLng(t,i),animation:google.maps.Animation.DROP,icon:a.icon,map:n}),a.setInfoWindow=function(e){google.maps.event.addListener(a.googleMarker,"click",function(){infoWindow=o.getInfoWindow(),infoWindow.setContent(a.content()),infoWindow.open(n,a.googleMarker)})},a.isVisible=ko.observable(!1),a.isVisible.subscribe(function(e){a.googleMarker.setMap(e?n:null)}),a.isVisible(!0);var s=window.mapBounds;s.extend(new google.maps.LatLng(t,i)),n.fitBounds(s),n.setCenter(s.getCenter())};ko.applyBindings(e),$(window).resize(function(){google.maps.event.trigger(o.getMap(),"resize")}),Offline.options={checkOnLoad:!0,interceptRequests:!0};var t=function(){"up"===Offline.state&&Offline.check()};setInterval(t,5e3)});
//# sourceMappingURL=all.min.js.map