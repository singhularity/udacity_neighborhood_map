function NeighborhoodViewModel(){function e(e,o){var n=Map.getMap(),a=new Marker(e[0],n);return t.markers.push(a),t.visibleMarkersCount(t.visibleMarkersCount()+1),t.locationLat(""),a}function o(o,n){if(n===google.maps.places.PlacesServiceStatus.OK){var t=e(o,n);setDataFromWikipedia(t)}}function n(o,n){if(n===google.maps.places.PlacesServiceStatus.OK){var t=e(o,n);setDataFromYelp(t)}}var t=this,a={Location:o,Business:n};ko.bindingHandlers.mapBinder={init:function(e,o,n,t){Map.setMap(o,e)}},t.centerMap=ko.observable(Map.getMapCenter()),t.mapDimensions=ko.observable(Map.getMapDimensions()),t.markers=ko.observableArray([]),t.locationLat=ko.observable(""),t.addNewMarkerOnMap=function(){t.addMarkerWithInfo(t.locationLat(),"Location")},t.addMarkerWithInfo=function(e,o){var n=a[o];Map.addMarkerOnMap(e,n)},t.toggle=ko.observable(!0),t.titleSearch=ko.observable(""),t.filteredMarkers=this.markers.filterByProperty("visible",!0),t.visibleMarkersCount=ko.observable(0),t.showDummyCard=ko.computed(function(){return 0===t.visibleMarkersCount()&&t.toggle}),t.markerToggler=function(e){t.visibleMarkersCount(0);for(var o in t.markers()){var n=t.markers()[o];n.isVisible(null!==n.title().match(e)),n.isVisible()&&t.visibleMarkersCount(t.visibleMarkersCount()+1)}},this.toggle.subscribe(function(e){t.markerToggler(e?"":null)}),this.toggleMarkersForSearch=function(e){var o=new RegExp(e,"i");t.markerToggler(o)},t.titleSearch.subscribe(t.toggleMarkersForSearch)}function initialize(e){var o=["New York, NY","London, UK","Mumbai, India","Paris, France"],n=["45 Rockefeller Plaza, New York"];for(var t in o)e.addMarkerWithInfo(o[t],"Location");for(var a in n)e.addMarkerWithInfo(n[a],"Business")}function setDataFromWikipedia(e){"down"==Offline.state?alert("No network"):$.ajax({url:"https://en.wikipedia.org/w/api.php?action=query&prop=extracts&format=json&exintro=&titles="+e.name,type:"GET",crossDomain:!0,dataType:"jsonp",timeout:5e3,success:function(o){var n;try{var t=Object.keys(o.query.pages)[0];n=$($(o.query.pages[t].extract)[0].innerHTML).text()}catch(a){n="Could not get additional information."}e.setClickEvent(n)},error:function(){e.setClickEvent("Could not get additional information.")}})}function setDataFromYelp(e){"down"==Offline.state?alert("No network"):$.ajax({url:"/yelpData?address="+e.name,type:"GET",dataType:"json",timeout:5e3,success:function(o){var n;try{n=$("<ul></ul>").html("<li>"+o.Summary+"</li>")}catch(t){n="Could not get additional information."}e.setClickEvent(n.html())},error:function(){e.setClickEvent("Could not get additional information.")}})}ko.observableArray.fn.filterByProperty=function(e,o){return ko.pureComputed(function(){for(var n=this(),t=[],a=0;a<n.length;a++){var i=n[a];ko.unwrap(i[e])===o&&t.push(i)}return t},this)};var Map={setMap:function(e,o){var n=ko.utils.unwrapObservable(e()),t=new google.maps.LatLng(ko.utils.unwrapObservable(n.lat),ko.utils.unwrapObservable(n.lng)),a={center:t,zoom:13};this.map=new google.maps.Map(o,a),window.mapBounds=new google.maps.LatLngBounds,this.searchService=new google.maps.places.PlacesService(this.map),this.infoWindow=new google.maps.InfoWindow({content:""})},getMap:function(){return this.map},getMapCenter:function(){return{lat:ko.observable(40.7127),lng:ko.observable(-74.0059)}},getMapDimensions:function(){var e=$("main").height()+40;return{width:"100%",height:""+e+"px"}},setInfoWindow:function(e,o){this.infoWindow.setContent(e),this.infoWindow.open(this.map,o)},addMarkerOnMap:function(e,o){var n=this.searchService,t={query:e};"down"==Offline.state?alert("No network"):n.textSearch(t,o)}},Marker=function(e,o){var n=e.geometry.location.lat(),t=e.geometry.location.lng(),a=e.formatted_address,i=this;i.icon={url:e.icon,size:new google.maps.Size(80,80),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)},i.title=ko.observable(a),i.name=e.name,i.content=ko.observable(""),i.infolink=ko.observable("https://en.wikipedia.org/wiki/"+i.name),i.googleMarker=new google.maps.Marker({position:new google.maps.LatLng(n,t),animation:google.maps.Animation.DROP,icon:i.icon,map:o}),i.setClickEvent=function(e){this.content(e),google.maps.event.addListener(i.googleMarker,"click",function(){Map.setInfoWindow(e,i.googleMarker)})},i.isVisible=ko.observable(!1),i.isVisible.subscribe(function(e){i.googleMarker.setMap(e?o:null)}),i.isVisible(!0);var r=window.mapBounds;r.extend(new google.maps.LatLng(n,t)),o.fitBounds(r),o.setCenter(r.getCenter())};$(window).resize(function(){google.maps.event.trigger(Map.getMap(),"resize")}),Offline.options={checkOnLoad:!0,interceptRequests:!0,requests:!0,game:!0};var run=function(){"up"===Offline.state&&Offline.check()};setInterval(run,5e3);var neighbourHood=new NeighborhoodViewModel;ko.applyBindings(neighbourHood),initialize(neighbourHood);
//# sourceMappingURL=all.min.js.map