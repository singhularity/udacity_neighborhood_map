function NeighborhoodViewModel(){function e(e,a){if(void 0!==e&&e.length>0){var o=Map.getMap(),n=new Marker(e[0],o);return i.markers.push(n),i.visibleMarkersCount(i.visibleMarkersCount()+1),i.locationLat(""),i.selectedType(""),n}alert("No matching location found!")}function a(a,o){if(o===google.maps.places.PlacesServiceStatus.OK){var n=e(a,o);setDataFromWikipedia(n,"City",t.City.icon)}}function o(a,o){if(o===google.maps.places.PlacesServiceStatus.OK){var n=e(a,o);setDataFromYelp(n,"Restaurants",t.Restaurants.icon)}}function n(a,o){if(o===google.maps.places.PlacesServiceStatus.OK){var n=e(a,o);setDataFromWikipedia(n,"Landmarks",t.Landmarks.icon)}}var i=this;ko.bindingHandlers.mapBinder={init:function(e,a,o,n){Map.setMap(a,e)}};var t={City:{google_name:"locality",func:a,icon:"http://maps.google.com/mapfiles/marker.png"},Restaurants:{google_name:"restaurant",func:o,icon:"http://maps.google.com/mapfiles/ms/icons/restaurant.png"},Landmarks:{google_name:"point_of_interest",func:n,icon:"http://maps.google.com/mapfiles/ms/icons/landmarks-jp.png"}};i.centerMap=ko.observable(Map.getMapCenter()),i.mapDimensions=ko.observable(Map.getMapDimensions()),i.markers=ko.observableArray(),i.locationLat=ko.observable(""),i.availableTypes=ko.observableArray(["City","Restaurants","Landmarks"]),i.selectedType=ko.observable(),i.selectedFilter=ko.observable(),i.addNewMarkerOnMap=function(){void 0===i.selectedType()?alert("Please select the type of location!"):i.addMarkerWithInfo(i.locationLat(),i.selectedType())},i.addMarkerWithInfo=function(e,a){var o=t[a].func;Map.addMarkerOnMap(e,o,t[a].google_name)},i.filterTypes=ko.observableArray(["All Pins","City","Restaurants","Landmarks","None"]),i.titleSearch=ko.observable(""),i.filteredMarkers=i.markers.filterByProperty("visible",!0),i.visibleMarkersCount=ko.observable(0),i.showDummyCard=ko.computed(function(){return 0===i.visibleMarkersCount()&&i.toggle}),i.markerToggler=function(e){i.visibleMarkersCount(0);for(var a in i.markers()){var o=i.markers()[a];o.isVisible(null!==o.name().match(e)),o.isVisible()&&i.visibleMarkersCount(i.visibleMarkersCount()+1)}},this.selectedFilter.subscribe(function(e){i.visibleMarkersCount(0);for(var a in i.markers()){var o=i.markers()[a];o.isVisible(o.category()===e||"All Pins"===e),o.isVisible()&&i.visibleMarkersCount(i.visibleMarkersCount()+1)}}),this.toggleMarkersForSearch=function(e){var a=new RegExp(e,"i");i.markerToggler(a)},i.titleSearch.subscribe(i.toggleMarkersForSearch)}function setDataFromServer(e,a,o,n,i){"down"===Offline.state?alert("No network"):$.ajax({url:e,type:"GET",dataType:"json",timeout:5e3,success:function(e){i(a,e,o,n)},error:function(){a.setClickEvent("Could not get additional information.")}})}function setDataFromWikipedia(e,a,o){setDataFromServer("/wikiData?name="+e.name(),e,a,o,wikipediaDataCallback)}function setDataFromYelp(e,a,o){setDataFromServer("/yelpData?address="+e.address(),e,a,o,yelpDataCallback)}function wikipediaDataCallback(e,a,o,n){var i=a.content;e.setClickEvent("<div><h6>"+o+"</h6>"+i+"</div>"),e.infolink("https://en.wikipedia.org/wiki/"+e.name()),e.category(o),e.googleMarker.setIcon({url:n,size:new google.maps.Size(80,80),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34)})}function yelpDataCallback(e,a,o,n){var i=a.content,t="<ul></ul>";t=$(t).html($("<li><strong>Name:&nbsp;</strong>"+i.Name+"</li><li><strong>Rating:&nbsp;</strong>"+i.Rating+"</li><li><strong>Summary/Comments:&nbsp;</strong>"+i.Summary+"</li><li><strong>Phone:&nbsp;</strong>"+i.Phone+"</li>")),e.setClickEvent($(t).html()),e.infolink(i.Url),e.category(o),e.googleMarker.setIcon({url:n,size:new google.maps.Size(80,80),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34)})}function initializeOfflineJs(){Offline.options={checkOnLoad:!0,interceptRequests:!0,requests:!0,game:!0,checks:{xhr:{url:"/heartbeat"}}};var e=function(){"up"===Offline.state&&Offline.check()};setInterval(e,5e3)}function initialize(e){initializeOfflineJs();var a=["New York, NY","London, UK","Mumbai, India"],o=["One Girl Cookies, Brooklyn","Grimaldi's, CA"],n=["Grand Canyon","Taj Mahal, India","Leaning Tower, Pisa"];for(var i in a)e.addMarkerWithInfo(a[i],"City");for(var t in o)e.addMarkerWithInfo(o[t],"Restaurants");for(var r in n)e.addMarkerWithInfo(n[r],"Landmarks")}ko.observableArray.fn.filterByProperty=function(e,a){var o=this;return ko.pureComputed(function(){for(var n=o(),i=[],t=0;t<n.length;t++){var r=n[t];ko.unwrap(r[e])===a&&i.push(r)}return i},o)};var Map={setMap:function(e,a){var o=ko.utils.unwrapObservable(e()),n=new google.maps.LatLng(ko.utils.unwrapObservable(o.lat),ko.utils.unwrapObservable(o.lng)),i={center:n,zoom:5};this.map=new google.maps.Map(a,i),window.mapBounds=new google.maps.LatLngBounds,this.searchService=new google.maps.places.PlacesService(this.map),this.infoWindow=new google.maps.InfoWindow({content:""})},getMap:function(){return this.map},getMapCenter:function(){return{lat:ko.observable(40.7127),lng:ko.observable(-74.0059)}},getMapDimensions:function(){var e=$("main").height()+40;return{width:"100%",height:""+e+"px"}},setInfoWindow:function(e,a){this.infoWindow.setContent(e),this.infoWindow.open(this.map,a)},addMarkerOnMap:function(e,a,o){var n=this.searchService,i={query:e,type:o};"down"===Offline.state?alert("No network"):n.textSearch(i,a)}},Marker=function(e,a){var o=e.geometry.location.lat(),n=e.geometry.location.lng(),i=this;i.name=ko.observable(e.name),i.address=ko.observable(e.formatted_address),i.content=ko.observable(""),i.infolink=ko.observable(""),i.category=ko.observable(""),i.googleMarker=new google.maps.Marker({position:new google.maps.LatLng(o,n),animation:google.maps.Animation.DROP,map:a}),i.setClickEvent=function(e){this.content(e),google.maps.event.addListener(i.googleMarker,"click",function(){Map.setInfoWindow(e,i.googleMarker)})},i.isVisible=ko.observable(!1),i.isVisible.subscribe(function(e){i.googleMarker.setMap(e?a:null)}),i.isVisible(!0);var t=window.mapBounds;t.extend(new google.maps.LatLng(o,n)),a.fitBounds(t),a.setCenter(t.getCenter())};$(window).resize(function(){google.maps.event.trigger(Map.getMap(),"resize")});var neighbourHood=new NeighborhoodViewModel;ko.applyBindings(neighbourHood),initialize(neighbourHood);
//# sourceMappingURL=all.min.js.map