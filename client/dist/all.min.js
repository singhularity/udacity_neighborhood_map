function NeighborhoodViewModel(){function e(e,o){if(void 0!==e&&e.length>0){var a=Map.getMap(),t=new Marker(e[0],a);return n.markers.push(t),n.visibleMarkersCount(n.visibleMarkersCount()+1),n.locationLat(""),n.selectedType(""),t}alert("No matching location found!")}function o(o,a){if(a===google.maps.places.PlacesServiceStatus.OK){var n=e(o,a);setDataFromWikipedia(n)}}function a(o,a){if(a===google.maps.places.PlacesServiceStatus.OK){var n=e(o,a);setDataFromYelp(n)}}var n=this,t={City:{google_name:"locality",func:o},Business:{google_name:"restaurant",func:a}};ko.bindingHandlers.mapBinder={init:function(e,o,a,n){Map.setMap(o,e)}},n.centerMap=ko.observable(Map.getMapCenter()),n.mapDimensions=ko.observable(Map.getMapDimensions()),n.markers=ko.observableArray(),n.locationLat=ko.observable(""),n.availableTypes=ko.observableArray(["City","Business"]),n.selectedType=ko.observable(),n.addNewMarkerOnMap=function(){void 0===n.selectedType()?alert("Please select the type of location!"):n.addMarkerWithInfo(n.locationLat(),n.selectedType())},n.addMarkerWithInfo=function(e,o){var a=t[o].func;Map.addMarkerOnMap(e,a,t[o].google_name)},n.toggle=ko.observable(!0),n.titleSearch=ko.observable(""),n.filteredMarkers=n.markers.filterByProperty("visible",!0),n.visibleMarkersCount=ko.observable(0),n.showDummyCard=ko.computed(function(){return 0===n.visibleMarkersCount()&&n.toggle}),n.markerToggler=function(e){n.visibleMarkersCount(0);for(var o in n.markers()){var a=n.markers()[o];a.isVisible(null!==a.title().match(e)),a.isVisible()&&n.visibleMarkersCount(n.visibleMarkersCount()+1)}},this.toggle.subscribe(function(e){n.markerToggler(e?"":null)}),this.toggleMarkersForSearch=function(e){var o=new RegExp(e,"i");n.markerToggler(o)},n.titleSearch.subscribe(n.toggleMarkersForSearch)}function setDataFromServer(e,o,a){"down"==Offline.state?alert("No network"):$.ajax({url:e,type:"GET",dataType:"json",timeout:5e3,success:function(e){a(o,e)},error:function(){o.setClickEvent("Could not get additional information.")}})}function setDataFromWikipedia(e){setDataFromServer("/wikiData?name="+e.name,e,wikipediaDataCallback)}function setDataFromYelp(e){setDataFromServer("/yelpData?address="+e.name,e,yelpDataCallback)}function wikipediaDataCallback(e,o){var a=o.content;e.setClickEvent(a),e.infolink("https://en.wikipedia.org/wiki/"+e.name)}function yelpDataCallback(e,o){var a=o.content;try{a="<ul><li id='summary'>"+a.Name+"</li></ul>"}catch(n){a="Could not get additional information."}e.setClickEvent(a),e.infolink(o.url)}function initialize(e){var o=["New York, NY","London, UK","Mumbai, India","Paris, France"],a=["Rockefeller Center, New York","Learning Tower, Pisa"];for(var n in o)e.addMarkerWithInfo(o[n],"City");for(var t in a)e.addMarkerWithInfo(a[t],"Business")}ko.observableArray.fn.filterByProperty=function(e,o){return ko.pureComputed(function(){for(var a=this(),n=[],t=0;t<a.length;t++){var i=a[t];ko.unwrap(i[e])===o&&n.push(i)}return n},this)};var Map={setMap:function(e,o){var a=ko.utils.unwrapObservable(e()),n=new google.maps.LatLng(ko.utils.unwrapObservable(a.lat),ko.utils.unwrapObservable(a.lng)),t={center:n,zoom:13};this.map=new google.maps.Map(o,t),window.mapBounds=new google.maps.LatLngBounds,this.searchService=new google.maps.places.PlacesService(this.map),this.infoWindow=new google.maps.InfoWindow({content:""})},getMap:function(){return this.map},getMapCenter:function(){return{lat:ko.observable(40.7127),lng:ko.observable(-74.0059)}},getMapDimensions:function(){var e=$("main").height()+40;return{width:"100%",height:""+e+"px"}},setInfoWindow:function(e,o){this.infoWindow.setContent(e),this.infoWindow.open(this.map,o)},addMarkerOnMap:function(e,o,a){var n=this.searchService,t={query:e,type:a};"down"==Offline.state?alert("No network"):n.textSearch(t,o)}},Marker=function(e,o){var a=e.geometry.location.lat(),n=e.geometry.location.lng(),t=e.formatted_address,i=this;i.icon={url:e.icon,size:new google.maps.Size(80,80),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(35,35)},i.title=ko.observable(t),i.name=e.name,i.content=ko.observable(""),i.infolink=ko.observable(""),i.googleMarker=new google.maps.Marker({position:new google.maps.LatLng(a,n),animation:google.maps.Animation.DROP,icon:i.icon,map:o}),i.setClickEvent=function(e){this.content(e),google.maps.event.addListener(i.googleMarker,"click",function(){Map.setInfoWindow(e,i.googleMarker)})},i.isVisible=ko.observable(!1),i.isVisible.subscribe(function(e){i.googleMarker.setMap(e?o:null)}),i.isVisible(!0);var r=window.mapBounds;r.extend(new google.maps.LatLng(a,n)),o.fitBounds(r),o.setCenter(r.getCenter())};$(window).resize(function(){google.maps.event.trigger(Map.getMap(),"resize")}),Offline.options={checkOnLoad:!0,interceptRequests:!0,requests:!0,game:!0,checks:{xhr:{url:"/heartbeat"}}};var run=function(){"up"===Offline.state&&Offline.check()};setInterval(run,5e3);var neighbourHood=new NeighborhoodViewModel;ko.applyBindings(neighbourHood),initialize(neighbourHood);
//# sourceMappingURL=all.min.js.map